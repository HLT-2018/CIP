##  章岳—条件随机场模型

### 目录结构
```
├─README.md
├─src
|  ├─Config.py：配置文件
|  ├─data_loader.py：数组读取类文件
|  ├─crf_model.py：条件随机场模型类文件
|  ├─run.py：运行文件
├─data
|  ├─dev.conll
|  └train.conll
├─bigdata
|    ├─dev
|    ├─test
|    └train
```

### 运行方式

#### 环境

Python3.8

#### 命令

```shell
cd ./src
python3 run.py
```

### 超参数选择

| 参数名称      | 用处                                                  | 默认取值 |
| ------------- | ----------------------------------------------------- | -------- |
| epoch         | 训练最大轮数                                          | 50       |
| exitor        | 退出轮数（多少轮无提升）                              | 5        |
| random_seed   | 随机种子                                              | 0        |
| shuffle       | 是否打乱数据集                                        | True     |
| batch_size    | 多少个样本更新一次权重（设为1则Mini-BGD退化为SGD）    | 32       |
| lmbda         | L2正则化系数（不需要正则化则设置为0）                 | 0.01     |
| learning_rate | 学习率                                                | 0.5      |
| decay_rate    | 学习率衰减速率（用于模拟退火，不需要模拟退火设置为1） | 0.96     |

### 运行结果

#### 1. 小数据集 + 正则化 + 模拟退火 + shuffle（正确率：88.96%）

```
打乱数据集...
##########开始训练##########
数据集：train.conll，句子数：803，词数：20454，词性数目：31
数据集：dev.conll，句子数：1910，词数：50319，词性数目：30

特征空间维度：67391(部分特征数)*31(词性数)
第1轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了19448个词的词性，正确率为:0.950816
开发集共有50319个词，预测正确了42032个词的词性，正确率为:0.835311

第2轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20129个词的词性，正确率为:0.984111
开发集共有50319个词，预测正确了43855个词的词性，正确率为:0.871540

第3轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20358个词的词性，正确率为:0.995307
开发集共有50319个词，预测正确了44349个词的词性，正确率为:0.881357

第4轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20413个词的词性，正确率为:0.997996
开发集共有50319个词，预测正确了44548个词的词性，正确率为:0.885312

第5轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20434个词的词性，正确率为:0.999022
开发集共有50319个词，预测正确了44595个词的词性，正确率为:0.886246

第6轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20445个词的词性，正确率为:0.999560
开发集共有50319个词，预测正确了44639个词的词性，正确率为:0.887120

第7轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20451个词的词性，正确率为:0.999853
开发集共有50319个词，预测正确了44639个词的词性，正确率为:0.887120

第8轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20451个词的词性，正确率为:0.999853
开发集共有50319个词，预测正确了44687个词的词性，正确率为:0.888074

第9轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20453个词的词性，正确率为:0.999951
开发集共有50319个词，预测正确了44705个词的词性，正确率为:0.888432

第10轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20454个词的词性，正确率为:1.000000
开发集共有50319个词，预测正确了44718个词的词性，正确率为:0.888690

第11轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20454个词的词性，正确率为:1.000000
开发集共有50319个词，预测正确了44737个词的词性，正确率为:0.889068

第12轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20454个词的词性，正确率为:1.000000
开发集共有50319个词，预测正确了44739个词的词性，正确率为:0.889107

第13轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20454个词的词性，正确率为:1.000000
开发集共有50319个词，预测正确了44743个词的词性，正确率为:0.889187

第14轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20454个词的词性，正确率为:1.000000
开发集共有50319个词，预测正确了44755个词的词性，正确率为:0.889425

第15轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20454个词的词性，正确率为:1.000000
开发集共有50319个词，预测正确了44765个词的词性，正确率为:0.889624

第16轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20454个词的词性，正确率为:1.000000
开发集共有50319个词，预测正确了44757个词的词性，正确率为:0.889465

第17轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20454个词的词性，正确率为:1.000000
开发集共有50319个词，预测正确了44761个词的词性，正确率为:0.889545

第18轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20454个词的词性，正确率为:1.000000
开发集共有50319个词，预测正确了44758个词的词性，正确率为:0.889485

第19轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20454个词的词性，正确率为:1.000000
开发集共有50319个词，预测正确了44756个词的词性，正确率为:0.889445

第20轮开始训练...
本轮训练完成，进行评估...
训练集共有20454个词，预测正确了20454个词的词性，正确率为:1.000000
开发集共有50319个词，预测正确了44751个词的词性，正确率为:0.889346
经过5轮模型正确率无提升，结束训练！最大正确率为第15轮训练后的0.889624
用时:0:07:38.230455
```

PS：大数据集会在服务器上跑一下，日后补上

### 几个易错点

+ forward算法和backward算法的传播过程编写需要注意，二者的运算是不同的

### 学习过程中的笔记和思考

[NLP自学笔记：条件随机场模型](https://hillzhang1999.gitee.io/2020/04/04/nlp-zi-xue-bi-ji-tiao-jian-sui-ji-chang-mo-xing/)

### 参考资料（部分）

+ [苏州大学李正华老师的课件](http://hlt.suda.edu.cn/~zhli/teach/cip-2015-fall/)

+ [如何轻松愉快地理解条件随机场（CRF）？](https://www.jianshu.com/p/55755fc649b1)

+ [如何用简单易懂的例子解释条件随机场（CRF）模型？它和HMM有什么区别？](https://www.zhihu.com/question/35866596)

+ [条件随机场](https://www.cnblogs.com/kerwins-AC/p/9584862.html)

+ 李航老师《统计学习方法》
